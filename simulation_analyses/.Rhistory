aes(
x = trtD2+alpha2/20,
y = Correct,
color = factor(alpha2)
),
size = 4) +
geom_errorbar(
aes(x = trtD2+alpha2/20,
ymin = Correct - 1.96*sqrt(Correct * (100-Correct)/n),
ymax = Correct + 1.96*sqrt(Correct * (100-Correct)/n),
color = factor(alpha2),
group = factor(alpha2)),
size = 1)+
theme_bw(25)+
theme(legend.position = "none",
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.ticks.x = element_blank())+
scale_color_discrete(expression(alpha[d]))+
scale_x_continuous(
expression(beta[d]),
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL)+
scale_y_continuous(
expression(Correct~CIs~alpha[m]),
limits = c(88,100), breaks = c(90, 95, 100)),
sumtab %>% filter(Parameter == "Alpha, Terminal1") %>%
filter(etaD == 16)%>%
ggplot() +
geom_hline(aes(yintercept = 95), linetype = 2)+
geom_point(
aes(x = trtD2+alpha2/20,
y = Correct.death,
color = factor(alpha2)),
size = 4) +
geom_errorbar(
aes(x = trtD2+alpha2/20,
ymin = Correct.death - 1.96*sqrt(Correct.death * (100-Correct.death)/n.death),
ymax = Correct.death + 1.96*sqrt(Correct.death * (100-Correct.death)/n.death),
color = factor(alpha2),
group = factor(alpha2)),
size = 1)+
theme_bw(25)+
theme(
legend.position = "none",
plot.margin = margin(0,.25,.25,.5,"cm"),
legend.background = element_rect(color = "grey80"),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank()
)+
scale_x_continuous(
expression(beta[d]),
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL
)+
scale_color_discrete(expression(alpha[2]))+
scale_y_continuous(
limits = c(88,100), breaks = c(90, 95, 100)) +
annotate("text", x = -.5, y = 89, hjust = 0,
size = 9, color = "#F8766D",
label = "`*`~Correctness~`<`~70~when~alpha[d]~'='~-1.",
parse = T),
nrow=3)
dev.off()
}
#############################################################################
# Plot Bias as function of death prevalence (etaM)
{
png("../simulation_results/TwentySevenScenario_Bias.png",
width = 1000, height = 1200)
gridExtra::grid.arrange(
############################################
#### Treatment Effect Delirium
sumtab %>%
mutate(n = 5000) %>%
filter(Parameter == "Recurrent: trt") %>%
ggplot() +
geom_hline(aes(yintercept = Truth), linetype = 4)+
geom_point(
aes(x = trtD2+alpha2/8 + (etaD-29)/400,
y = Truth+bias,
color = factor(alpha2),
shape = factor(etaD)),
size = 4) +
#geom_errorbar(
#	aes(
#		x = trtD2+alpha2/8 + (etaD-29)/400,
#		ymin = Truth+bias-2*SD/sqrt(n),
#		ymax = Truth+bias+2*SD/sqrt(n),
#		color = factor(alpha2),
#		group = factor(alpha2)),
#	  size = 1)+
theme_bw(25)+
theme(legend.position = "none",
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank())+
ylim(-0.54, -0.46)+
scale_color_discrete(expression(alpha[d]))+
scale_x_continuous(breaks = c(-0.5, 0, 0.5),minor_breaks = NULL)+
xlab(expression(beta[d]))+
ylab(expression(Average~Estimate~beta[r]))+
ggtitle("Competing Joint Model (a)"),
sumtab %>% filter(Parameter == "Recurrent: trt") %>%
ggplot() +
geom_hline(aes(yintercept = Truth), linetype = 2)+
geom_point(
aes(
x = trtD2+alpha2/8 + (etaD-29)/400,
y = Truth+bias.death,
color = factor(alpha2),
shape = factor(etaD)),
size = 4
) +
#geom_errorbar(
#	aes(
#		x = trtD2+alpha2/8 + (etaD-29)/400,
#		ymin = Truth+bias.death-2*SD.death/sqrt(n.death),
#		ymax = Truth+bias.death+2*SD.death/sqrt(n.death),
#		color = factor(alpha2),
#		group = factor(alpha2)),
#	  size = 1)+
theme_bw(25)+
theme(legend.position = "none",
legend.background = element_rect(color = "grey80"),
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank())+
ylim(-0.54, -0.46)+
scale_color_discrete(expression(alpha[d]))+
scale_x_continuous(breaks = c(-0.5, 0, 0.5),minor_breaks = NULL)+
xlab(expression(beta[d]))+
ylab(expression(Average~Estimate~beta[r]))+
ggtitle("Joint, Death (b)"),
############################################
#### Treatment Effect Mortality
sumtab %>% filter(Parameter == "Terminal1: trt") %>%
ggplot() +
geom_hline(aes(yintercept = Truth), linetype = 2)+
geom_point(
aes(
x = trtD2+alpha2/8 + (etaD-29)/400,
y = Truth+bias,
color = factor(alpha2),
shape = factor(etaD)),
size = 4)+
#geom_errorbar(
#	aes(
#		x = trtD2+alpha2/8 + (etaD-29)/400,
#		ymin = Truth+bias-2*SD/sqrt(n),
#		ymax = Truth+bias+2*SD/sqrt(n),
#		color = factor(alpha2),
#		group = factor(alpha2)),
#	  size = 1) +
theme_bw(25)+
theme(legend.position = c(.5, .8),
#legend.justification = 1,
legend.box.just = "center",
legend.background = element_rect(color = "grey80"),
legend.spacing = unit(0,"cm"),
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank())+
scale_shape_discrete(
expression(a[m]),
guide = guide_legend(
direction = "horizontal", label.hjust = 0))+
scale_color_discrete(
expression(alpha[d]),
guide = guide_legend(
direction = "horizontal", label.hjust = 0))+
scale_x_continuous(
expression(beta[d]),
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL)+
scale_y_continuous(
expression(Average~Estimate~beta[m]),
limits = c(-0.6, -0.4)),
sumtab %>% filter(Parameter == "Terminal1: trt") %>%
ggplot() +
geom_hline(aes(yintercept = Truth), linetype = 2)+
geom_point(aes(x = trtD2+alpha2/8 + (etaD-29)/400,
y = Truth+bias.death, color = factor(alpha2),shape = factor(etaD)
),
size = 4) +
#geom_errorbar(
#	aes(
#		x = trtD2+alpha2/8 + (etaD-29)/400,
#		ymin = Truth+bias.death-2*SD.death/sqrt(n.death),
#		ymax = Truth+bias.death+2*SD.death/sqrt(n.death),
#		color = factor(alpha2),
#		group = factor(alpha2)),
#	  size = 1)+
scale_x_continuous(breaks = c(-0.5, 0, 0.5),minor_breaks = NULL)+
theme_bw(25)+
theme(legend.position = "none",
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
#title = element_blank(),
legend.background = element_rect(color = "grey80"),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank()
)+
scale_color_discrete(expression(alpha[d]))+
scale_y_continuous(expression(Average~Estimate~beta[m]),
limits = c(-0.6, -0.4))+
xlab(expression(beta[d])),
############################################
#### Alpha Mortality
sumtab %>% filter(Parameter == "Alpha, Terminal1") %>%
#filter(etaD == 16)%>%
ggplot() +
geom_hline(aes(yintercept = Truth), linetype = 2)+
geom_point(
aes(
x = trtD2+alpha2/8 + (etaD-29)/400 ,
y = Truth+bias,
color = factor(alpha2),
shape = factor(etaD)
),
size = 4) +
#geom_errorbar(
#	aes(
#		x = trtD2+alpha2/8 + (etaD-29)/400,
#		ymin = Truth+bias-2*SD/sqrt(n),
#		ymax = Truth+bias+2*SD/sqrt(n),
#		color = factor(alpha2),
#		group = factor(alpha2)),
#	  size = 1)+
theme_bw(25)+
theme(legend.position = "none",
plot.margin = margin(0.1,.25,.25,1,"cm"),
axis.ticks.x = element_blank())+
scale_x_continuous(
expression(beta[d]),
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL)+
ylim(0.65, 2)+
xlab(expression(beta[d]))+
ylab(expression(Average~Estimate~alpha[m])),
sumtab %>%
filter(Parameter == "Alpha, Terminal1") %>%
ggplot() +
geom_hline(aes(yintercept = Truth), linetype = 2)+
geom_point(
aes(
x = trtD2+alpha2/8 + (etaD-29)/400,
y = Truth+bias.death,
color = factor(alpha2),
shape = factor(etaD)
),
size = 4)+
#geom_errorbar(
#	aes(
#		x = trtD2+alpha2/8 + (etaD-29)/400,
#		ymin = Truth+bias.death-2*SD.death/sqrt(n.death),
#		ymax = Truth+bias.death+2*SD.death/sqrt(n.death),
#		color = factor(alpha2),
#		group = factor(alpha2)),
#	  size = 1)+
theme_bw(25)+
theme(
legend.position = "none",
plot.margin = margin(0,.25,.25,.5,"cm"),
legend.background = element_rect(color = "grey80"),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank()
)+
scale_x_continuous(
expression(beta[d]),
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL
)+
ylim(0.65, 2)+
ylab(expression(Average~Estimate~alpha[m])),
nrow=3)
dev.off()
}
#############################################################################
# Plot %Correct by alphaD, betaD, etaM
{
png("../simulation_results/TwentysevenScenario_Correctness.png",
width = 1000, height = 1200)
gridExtra::grid.arrange(
#### Treatment Effect Delirium
sumtab %>%
filter(Parameter == "Recurrent: trt") %>%
ggplot() +
geom_hline(aes(yintercept = 95), linetype = 4)+
geom_point(
aes(x = trtD2+alpha2/8 + (etaD-29)/400 ,
y = Correct,
color = factor(alpha2),
shape = factor(etaD)),
size = 4) +
geom_errorbar(
aes(x = trtD2+alpha2/8 + (etaD-29)/400,
ymin = Correct - 1.96*sqrt(Correct * (100-Correct)/n),
ymax = Correct + 1.96*sqrt(Correct * (100-Correct)/n),
color = factor(alpha2),
group = factor(alpha2)),
size = 1)+
theme_bw(25)+
theme(legend.position = "none",
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank())+
scale_y_continuous(
expression(Correct~CIs~beta[r]),
limits = c(88, 100), breaks = c(90, 95, 100))+
scale_x_continuous(
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL)+
ggtitle("Competing Joint Model (a)"),
sumtab %>%
filter(Parameter == "Recurrent: trt") %>%
ggplot() +
geom_hline(aes(yintercept = 95), linetype = 2)+
geom_point(
aes(
x = trtD2+alpha2/8 + (etaD-29)/400 ,
y = Correct.death,
color = factor(alpha2),
shape = factor(etaD)),
size = 4) +
geom_errorbar(
aes(x = trtD2+alpha2/8 + (etaD-29)/400 ,
ymin = Correct.death - 1.96*sqrt(Correct.death * (100-Correct.death)/n.death),
ymax = Correct.death + 1.96*sqrt(Correct.death * (100-Correct.death)/n.death),
color = factor(alpha2),
group = factor(alpha2)),
size = 1)+
theme_bw(25)+
theme(legend.position = "none",
legend.background = element_rect(color = "grey80"),
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank())+
scale_y_continuous(limits = c(88, 100), breaks = c(90, 95, 100))+
scale_color_discrete(expression(alpha[d]))+
scale_x_continuous(
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL)+
ggtitle("Joint, Death (b)"),
#### Treatment Effect Mortality
sumtab %>% filter(Parameter == "Terminal1: trt") %>%
ggplot() +
geom_hline(aes(yintercept = 95), linetype = 2)+
geom_point(
aes(x = trtD2+alpha2/8 + (etaD-29)/400 ,
y = Correct,
color = factor(alpha2),
shape = factor(etaD)),
size = 4) +
geom_errorbar(
aes(x = trtD2+alpha2/8 + (etaD-29)/400 ,
ymin = Correct - 1.96*sqrt(Correct * (100-Correct)/n),
ymax = Correct + 1.96*sqrt(Correct * (100-Correct)/n),
color = factor(alpha2),
group = factor(alpha2)),
size = 1) +
theme_bw(25)+
theme(legend.position = c(.5, .3),
#legend.justification = 1,
legend.box.just = "center",
legend.background = element_rect(color = "grey80"),
legend.spacing = unit(0,"cm"),
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank())+
scale_color_discrete(expression(alpha[d]),
guide = guide_legend(
direction = "horizontal"))+
scale_x_continuous(
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL)+
scale_y_continuous(
expression(Correct~CIs~beta[m]),
limits = c(88, 100), breaks = c(90, 95, 100))+
scale_shape_discrete(
expression(a[m]),
guide = guide_legend(
direction = "horizontal")),
sumtab %>% filter(Parameter == "Terminal1: trt") %>%
ggplot() +
geom_hline(aes(yintercept = 95), linetype = 2)+
geom_point(
aes(x = trtD2+alpha2/8 + (etaD-29)/400 ,
y = Correct.death,
color = factor(alpha2),
shape = factor(etaD)),
size = 4) +
geom_errorbar(
aes(x = trtD2+alpha2/8 + (etaD-29)/400 ,
ymin = Correct.death - 1.96*sqrt(Correct.death * (100-Correct.death)/n.death),
ymax = Correct.death + 1.96*sqrt(Correct.death * (100-Correct.death)/n.death),
color = factor(alpha2),
group = factor(alpha2)),
size = 1)+
theme_bw(25)+
theme(legend.position = "none",
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
#title = element_blank(),
legend.background = element_rect(color = "grey80"),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank()
)+
scale_color_discrete(
expression(alpha[d]))+
scale_y_continuous(
limits = c(88,100),
breaks = c(90, 95, 100))+
scale_x_continuous(
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL),
#### Alpha Mortality
sumtab %>% filter(Parameter == "Alpha, Terminal1") %>%
ggplot() +
geom_hline(
aes(yintercept = 95),
linetype = 2
)+
geom_point(
aes(
x = trtD2+alpha2/8 + (etaD-29)/400 ,
y = Correct,
color = factor(alpha2),
shape = factor(etaD)
),
size = 4) +
geom_errorbar(
aes(x = trtD2+alpha2/8 + (etaD-29)/400 ,
ymin = Correct - 1.96*sqrt(Correct * (100-Correct)/n),
ymax = Correct + 1.96*sqrt(Correct * (100-Correct)/n),
color = factor(alpha2),
group = factor(alpha2)),
size = 1)+
theme_bw(25)+
theme(legend.position = "none",
plot.margin = margin(0,.25,.25,.5,"cm"),
axis.ticks.x = element_blank())+
scale_color_discrete(expression(alpha[d]))+
scale_x_continuous(
expression(beta[d]),
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL)+
scale_y_continuous(
expression(Correct~CIs~alpha[m]),
limits = c(88,100), breaks = c(90, 95, 100)),
sumtab %>% filter(Parameter == "Alpha, Terminal1") %>%
ggplot() +
geom_hline(aes(yintercept = 95), linetype = 2)+
geom_point(
aes(x = trtD2+alpha2/8 + (etaD-29)/400 ,
y = Correct.death,
color = factor(alpha2),
shape = factor(etaD)),
size = 4) +
geom_errorbar(
aes(x = trtD2+alpha2/8 + (etaD-29)/400 ,
ymin = Correct.death - 1.96*sqrt(Correct.death * (100-Correct.death)/n.death),
ymax = Correct.death + 1.96*sqrt(Correct.death * (100-Correct.death)/n.death),
color = factor(alpha2),
group = factor(alpha2)),
size = 1)+
theme_bw(25)+
theme(
legend.position = "none",
plot.margin = margin(0,.25,.25,.5,"cm"),
legend.background = element_rect(color = "grey80"),
axis.title.y = element_blank(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.x = element_blank()
)+
scale_x_continuous(
expression(beta[d]),
breaks = c(-0.5, 0, 0.5),
minor_breaks = NULL
)+
scale_color_discrete(expression(alpha[2]))+
scale_y_continuous(
limits = c(88,100), breaks = c(90, 95, 100)) +
annotate("text", x = -.5, y = 89, hjust = 0,
size = 9, color = "#F8766D",
label = "`*`~Correctness~`<`~70~when~alpha[d]~'='~-1.",
parse = T),
nrow=3)
dev.off()
}
