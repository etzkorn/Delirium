knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(frailtypack); library(tidyverse)
source("../delirium_package/R/competing_simulate_data.R")
source("../delirium_package/R/random_weibull.R")
source("../delirium_package/R/extract_frailtypack_coef_weibullgap.R")
set.seed(080621)
par00 = c(betaR = 1, etaR = 8,
betaD = 1.8, etaD = 25,
betaD2 = 1.15, etaD2 = 10,
theta = 0.5, alpha1 = 0.15, alpha2 = -0.3,
trtR = -0.1, trtD = -0.05, trtD2 = 0.075)
# put in treatment effects
# opposite directions for alpha
#alpha1 = 0.15
#alpha2 = -0.3
data <-
simulate.competing.data(n = 1200, truncate = 28, par0 = par00)
data %>%
group_by(id) %>%
summarise(del = any(event==1),
death = any(terminal1==1),
discharge = any(terminal2==1)) %>%
summarise(mean(del), mean(death), mean(discharge),
mean(death*del)/mean(death), mean((discharge*del))/mean(discharge)) %>%
t
mod0 <-
multivPenal(
formula = Surv(t0, t, event)~cluster(id)+trt+terminal(terminal1)+terminal2(terminal2),
formula.terminalEvent=~trt,
formula.terminalEvent2=~trt,
data=data,
jointGeneral = F,
initialize = T,
save.progress = T,
hazard = "Weibull",
gapTimes=T,
maxit = 200)
mod0$initialization$joint1
mod0$critCV
mod0$summary.table
